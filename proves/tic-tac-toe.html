<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tic Tac Toe — Integració Overlay</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#7c3aed;
    --muted:#9aa4b2;
    --white:#e6eef8;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{
    background:linear-gradient(180deg,#071028 0%, #071a2a 100%);
    color:var(--white);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }

  /* Contenidor general del joc */
  #gameWrap{
    position:relative; /* IMPORTANT: overlay absolut es refereix a aquest contenidor */
    width:360px;
    max-width:calc(100vw - 48px);
    background:var(--panel);
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 30px rgba(2,6,23,0.6);
    box-sizing:border-box;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:12px;
  }
  header h1{font-size:16px;margin:0;color:var(--white);letter-spacing:0.2px}
  .controls button{
    background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 10px;border-radius:8px;cursor:pointer;
  }

  /* Tauler */
  .board{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
    margin:8px 0 12px 0;
  }
  .cell{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    height:92px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:36px;
    color:var(--white);
    border-radius:8px;
    cursor:pointer;
    user-select:none;
  }
  .cell.disabled{cursor:default;opacity:0.85}

  /* Estat / informació */
  .status{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    color:var(--muted);
    font-size:13px;
  }

  /* OVERLAY: ara cobreix només el recuadre del joc */
  #overlay{
    position:absolute;
    inset:0; /* top:0; right:0; bottom:0; left:0; */
    display:none; /* es mostra via JS quan acaba la partida */
    align-items:center;
    justify-content:center;
    background:rgba(2,6,23,0.78);
    z-index:40;
    border-radius:12px; /* coincideix amb #gameWrap */
    padding:18px;
    box-sizing:border-box;
  }
  #overlay.show{display:flex}

  .overlay-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:18px;
    border-radius:10px;
    min-width:240px;
    text-align:center;
    color:var(--white);
    box-shadow:0 8px 30px rgba(2,6,23,0.6);
  }
  .overlay-card h2{margin:0 0 8px 0;font-size:18px}
  .overlay-card p{margin:0 0 12px 0;color:var(--muted)}
  .overlay-card button{
    background:var(--accent);
    color:white;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
  }

  /* petites adaptacions responsives */
  @media (max-width:420px){
    .cell{height:72px;font-size:30px}
    #gameWrap{width:320px}
  }
</style>
</head>
<body>

  <div id="gameWrap">
    <header>
      <h1>Tic Tac Toe</h1>
      <div class="controls">
        <button id="resetBtn" title="Reinicia">Reinicia</button>
      </div>
    </header>

    <div class="status">
      <div id="turnInfo">Torn: <strong id="playerTurn">X</strong></div>
      <div id="score">X: <span id="scoreX">0</span> • O: <span id="scoreO">0</span></div>
    </div>

    <div class="board" id="board">
      <div class="cell" data-index="0"></div>
      <div class="cell" data-index="1"></div>
      <div class="cell" data-index="2"></div>
      <div class="cell" data-index="3"></div>
      <div class="cell" data-index="4"></div>
      <div class="cell" data-index="5"></div>
      <div class="cell" data-index="6"></div>
      <div class="cell" data-index="7"></div>
      <div class="cell" data-index="8"></div>
    </div>

    <!-- OVERLAY MOGUT DINS DE #gameWrap: cobreix només el recuadre del joc -->
    <div id="overlay" aria-hidden="true">
      <div class="overlay-card" role="dialog" aria-modal="true">
        <h2 id="overlayTitle">Partida acabada</h2>
        <p id="overlayMsg">Missatge</p>
        <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
          <button id="playAgain">Torna a jugar</button>
          <button id="closeOverlay" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white)">Tancar</button>
        </div>
      </div>
    </div>

  </div> <!-- fi #gameWrap -->

<script>
  // Lògica mínima del joc per demostrar l'overlay
  const boardEl = document.getElementById('board');
  const cells = Array.from(document.querySelectorAll('.cell'));
  const playerTurnEl = document.getElementById('playerTurn');
  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlayTitle');
  const overlayMsg = document.getElementById('overlayMsg');
  const playAgainBtn = document.getElementById('playAgain');
  const closeOverlayBtn = document.getElementById('closeOverlay');
  const resetBtn = document.getElementById('resetBtn');
  const scoreXEl = document.getElementById('scoreX');
  const scoreOEl = document.getElementById('scoreO');

  let boardState = Array(9).fill(null);
  let currentPlayer = 'X';
  let scores = { X: 0, O: 0 };
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  function startNewGame(){
    boardState.fill(null);
    cells.forEach(c => { c.textContent=''; c.classList.remove('disabled'); });
    currentPlayer = 'X';
    playerTurnEl.textContent = currentPlayer;
    hideOverlay();
  }

  function showOverlay(title, msg){
    overlayTitle.textContent = title;
    overlayMsg.textContent = msg;
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
  }
  function hideOverlay(){
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
  }

  function checkWin(){
    for(const combo of wins){
      const [a,b,c] = combo;
      if(boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c]){
        return boardState[a];
      }
    }
    if(boardState.every(Boolean)) return 'draw';
    return null;
  }

  function handleCellClick(e){
    const idx = Number(e.currentTarget.dataset.index);
    if(boardState[idx]) return;
    boardState[idx] = currentPlayer;
    e.currentTarget.textContent = currentPlayer;
    e.currentTarget.classList.add('disabled');

    const result = checkWin();
    if(result){
      if(result === 'draw'){
        showOverlay('Empat', 'Cap dels dos ha guanyat.');
      } else {
        scores[result] += 1;
        scoreXEl.textContent = scores.X;
        scoreOEl.textContent = scores.O;
        showOverlay('Guanyador', `Ha guanyat ${result}!`);
      }
      // desactivar totes les cel·les
      cells.forEach(c => c.classList.add('disabled'));
      return;
    }

    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
    playerTurnEl.textContent = currentPlayer;
  }

  cells.forEach(c => c.addEventListener('click', handleCellClick));
  playAgainBtn.addEventListener('click', startNewGame);
  closeOverlayBtn.addEventListener('click', hideOverlay);
  resetBtn.addEventListener('click', () => {
    scores = { X:0, O:0 };
    scoreXEl.textContent = '0';
    scoreOEl.textContent = '0';
    startNewGame();
  });

  // Inicia la primera partida
  startNewGame();
</script>
</body>
</html>
