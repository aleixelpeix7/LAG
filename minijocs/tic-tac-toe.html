<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3 en ratlla | LAG</title>
  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <style>
    /* ====== BASE ====== */
    :root {
      --wrap-w: 400px;
      --accent: #0af;
      --bg: #002244;
      --panel: #00152e;
      --gold: #FFDF20;
      --red: #FB2C36;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: var(--bg);
      color: #FAFAF9;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding-bottom: 24px;
    }

    h1 { font-size: 20px; margin-top: 6px; }

    /* ====== NAV (replicada per ser id√®ntica a serp.html) ====== */
    nav {
      background-color: rgba(0, 0, 0, 0.7);
      position: sticky;
      top: 0;
      width: 100%;
      z-index: 100;
      padding: 1rem 2rem;
    }

    /* centrem el contingut de la nav amb l'amplada del wrap */
    nav ul {
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: var(--wrap-w);
      margin: 0 auto;
      padding: 0;
    }

    nav li.logo {
      display: flex;
      align-items: center;
    }
    nav li.logo a {
      display: flex;
      align-items: center;
      text-decoration: none;
    }
    nav li.logo img {
      height: 60px;
      margin-right: 0.5rem;
      vertical-align: middle;
    }

    nav li.enllacos {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s;
    }
    nav a:hover { color: #ffff66; }

    /* Enlla√ß "Inici" vermell a l'esquerra del wrap (id√®ntic a serp.html) */
    .enllac-inici {
      position: absolute;
      left: calc(50% - 210px); /* 50% - (wrap/2 + 10px) per col¬∑locar-lo a l'esquerra del requadre */
      top: 20px;
      font-size: 20px;
      color: #FF2056;
      text-decoration: underline;
      font-weight: bold;
      z-index: 110;
    }
    .enllac-inici:hover { color: #FF637E; }

    /* ====== WRAP / REQUADRE (estil serp) ====== */
    #gameWrap {
      position: relative;
      width: var(--wrap-w);
      margin-top: 12px;
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      border-radius: 10px;
      padding: 12px;
      border: 2px solid rgba(10,170,255,0.08);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    /* ====== MENU ====== */
    #menu { width: 100%; display:flex; flex-direction:column; gap:10px; align-items:center; }
    .menu-row { width:100%; display:flex; justify-content:space-between; align-items:center; padding:6px 4px; }
    .label { font-weight:700; color: var(--gold); }
    .switch { display:flex; gap:8px; align-items:center; }
    .option {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.03);
      padding: 8px 10px;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .option.selected { outline: 2px solid var(--accent); transform: translateY(-2px); }

    .difficulty { display:flex; gap:8px; }
    .diff-btn { padding:6px 10px; border-radius:8px; background:#0b2a3f; color:#fff; cursor:pointer; font-weight:700; }
    .diff-btn.sel { outline:2px solid var(--accent); transform:translateY(-2px); }

    #playBtn {
      margin-top:6px;
      background: var(--gold);
      color: var(--red);
      padding:10px 18px;
      border-radius:10px;
      border:none;
      font-weight:800;
      cursor:pointer;
      width:100%;
    }

    /* ====== GAME AREA ====== */
    #gameArea { display:none; width:100%; flex-direction:column; align-items:center; gap:10px; }
    #status { font-weight:700; color: var(--gold); }

    .board {
      width:100%;
      max-width:360px;
      aspect-ratio: 1/1;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      grid-auto-rows: 1fr; /* files iguals */
      gap:6px;
      padding:8px;
      background:#111;
      border-radius:8px;
      border:2px solid rgba(255,255,255,0.03);
    }

    .cell {
      background: var(--panel);
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:48px;
      font-weight:900;
      color: var(--gold);
      cursor:pointer;
      user-select:none;
      transition: transform .08s, background .12s;
      min-height:0;
      min-width:0;
      line-height:1;
      padding:0;
      overflow:hidden;
    }
    .cell:hover { transform:scale(1.03); background:#002b55; }
    .cell.disabled { cursor:default; opacity:0.75; }
    .cell.win { background:#0b6623; color:#fff; }

    .controls { display:flex; gap:8px; justify-content:center; width:100%; }
    .btn { background: var(--gold); color: var(--red); padding:8px 12px; border-radius:8px; border:none; font-weight:800; cursor:pointer; }

    /* ====== OVERLAY dins del gameWrap (nom√©s cobreix el requadre) ====== */
    #gameOverlay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      z-index: 250;
    }
    .overlay-card {
      background: linear-gradient(180deg,#012233,#001522);
      padding: 18px;
      border-radius: 10px;
      border: 2px solid rgba(10,170,255,0.08);
      text-align:center;
      color:#fff;
      min-width:240px;
    }
    .overlay-card h2 { margin-bottom:8px; }
    .overlay-card button { margin-top:12px; padding:8px 12px; border-radius:8px; border:none; background:var(--gold); color:var(--red); font-weight:800; cursor:pointer; }

    .muted { font-size:13px; color:#cfd8e3; }

    @media (max-width:480px){
      :root { --wrap-w: calc(100% - 40px); }
      .enllac-inici { left: 12px; top: 12px; font-size:16px; }
    }
  </style>
</head>
<body>

  <!-- NAV: estructura id√®ntica a serp.html -->
  <nav>
    <ul>
      <li class="logo">
        <a href="https://lagg.netlify.app">
          <img src="assets/logo.png" alt="Logo GLS" />
        </a>
      </li>
      <li class="enllacos">
        <a href="https://lagg.netlify.app">Inici</a>
        <a href="https://lagg.netlify.app/minijocs/">Minijocs</a>
        <a href="https://lagg.netlify.app/minecraft/">Minecraft</a>
        <a href="https://lagg.netlify.app/contacte">Contactar</a>
      </li>
    </ul>

    <!-- Enlla√ß vermell "Inici" a l'esquerra del wrap (com a serp.html) -->
    <a class="enllac-inici" href="https://lagg.netlify.app">Inici</a>
  </nav>

  <h1>‚≠ï 3 en ratlla ‚ùå</h1>

  <!-- GAME WRAP -->
  <div id="gameWrap">
    <div class="panel">

      <!-- MEN√ö -->
      <div id="menu">
        <div class="menu-row">
          <div class="label">Rival</div>
          <div class="switch" id="rivalSwitch">
            <div class="option" id="optFriend">üë• Amic</div>
            <div class="option selected" id="optBot">ü§ñ Bot</div>
          </div>
        </div>

        <div class="menu-row">
          <div class="label">Mode peces</div>
          <div class="switch">
            <div class="option selected" id="optInfinite">‚ôæÔ∏è Infinites</div>
            <div class="option" id="optThree">3 peces</div>
          </div>
        </div>

        <div class="menu-row" id="difficultyRow">
          <div class="label">Dificultat bot</div>
          <div class="difficulty">
            <div class="diff-btn" data-diff="easy">F√†cil</div>
            <div class="diff-btn sel" data-diff="medium">Normal</div>
            <div class="diff-btn" data-diff="hard">Dif√≠cil</div>
          </div>
        </div>

        <div style="width:100%;display:flex;flex-direction:column;gap:6px">
          <div class="muted">Tria les opcions i prem <strong>Jugar</strong></div>
          <button id="playBtn">‚ñ∂Ô∏è Jugar</button>
        </div>
      </div>

      <!-- √ÄREA DE JOC -->
      <div id="gameArea">
        <div id="status">Torn del jugador: <strong id="turnLabel">X</strong></div>

        <div class="board" id="board">
          <div class="cell" data-index="0"></div>
          <div class="cell" data-index="1"></div>
          <div class="cell" data-index="2"></div>
          <div class="cell" data-index="3"></div>
          <div class="cell" data-index="4"></div>
          <div class="cell" data-index="5"></div>
          <div class="cell" data-index="6"></div>
          <div class="cell" data-index="7"></div>
          <div class="cell" data-index="8"></div>
        </div>

        <div class="controls">
          <button class="btn" id="resetBtn">üîÅ Reiniciar</button>
          <button class="btn" id="menuBtn">üè† Men√∫</button>
        </div>
      </div>

    </div>

    <!-- OVERLAY: cobreix nom√©s el requadre -->
    <div id="gameOverlay" aria-hidden="true">
      <div class="overlay-card">
        <h2 id="overlayTitle">Resultat</h2>
        <div id="overlayMsg" class="muted"></div>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
          <button id="overlayMenu">Tornar al men√∫</button>
          <button id="overlayPlay">Jugar de nou</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ELEMENTS */
    const optFriend = document.getElementById('optFriend');
    const optBot = document.getElementById('optBot');
    const optInfinite = document.getElementById('optInfinite');
    const optThree = document.getElementById('optThree');
    const difficultyRow = document.getElementById('difficultyRow');
    const diffBtns = Array.from(document.querySelectorAll('.diff-btn'));
    const playBtn = document.getElementById('playBtn');
    const menu = document.getElementById('menu');
    const gameArea = document.getElementById('gameArea');
    const boardEl = document.getElementById('board');
    const cells = Array.from(boardEl.querySelectorAll('.cell'));
    const statusLabel = document.getElementById('turnLabel');
    const resetBtn = document.getElementById('resetBtn');
    const menuBtn = document.getElementById('menuBtn');
    const gameOverlay = document.getElementById('gameOverlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayMsg = document.getElementById('overlayMsg');
    const overlayMenu = document.getElementById('overlayMenu');
    const overlayPlay = document.getElementById('overlayPlay');

    /* STATE */
    let vsBot = true;
    let piecesMode = 'infinite';
    let difficulty = 'medium';
    let currentPlayer = 'X';
    let board = Array(9).fill(null);
    let gameOver = false;
    let placedX = 0, placedO = 0, selectedPiece = null;

    /* UI handlers */
    function selectOption(group, el){
      if(group==='rival'){
        vsBot = (el === optBot);
        optBot.classList.toggle('selected', vsBot);
        optFriend.classList.toggle('selected', !vsBot);
        difficultyRow.style.display = vsBot ? 'flex' : 'none';
      } else if(group==='pieces'){
        piecesMode = (el === optThree) ? 'three' : 'infinite';
        optThree.classList.toggle('selected', piecesMode==='three');
        optInfinite.classList.toggle('selected', piecesMode==='infinite');
      }
    }
    optFriend.addEventListener('click', ()=>selectOption('rival', optFriend));
    optBot.addEventListener('click', ()=>selectOption('rival', optBot));
    optInfinite.addEventListener('click', ()=>selectOption('pieces', optInfinite));
    optThree.addEventListener('click', ()=>selectOption('pieces', optThree));
    diffBtns.forEach(btn=>btn.addEventListener('click', ()=>{
      diffBtns.forEach(b=>b.classList.remove('sel'));
      btn.classList.add('sel');
      difficulty = btn.dataset.diff;
    }));
    selectOption('rival', optBot);
    selectOption('pieces', optInfinite);

    /* START */
    playBtn.addEventListener('click', ()=>{
      resetAll();
      menu.style.display = 'none';
      gameArea.style.display = 'flex';
      updateStatus();
    });

    menuBtn.addEventListener('click', showMenu);
    overlayMenu.addEventListener('click', showMenu);
    overlayPlay.addEventListener('click', ()=>{ gameOverlay.style.display='none'; resetAll(); });

    function showMenu(){
      gameOverlay.style.display='none';
      gameArea.style.display='none';
      menu.style.display='flex';
    }

    /* GAME LOGIC */
    function updateStatus(){ statusLabel.textContent = currentPlayer; }

    function resetAll(){
      board = Array(9).fill(null);
      gameOver = false;
      currentPlayer = 'X';
      placedX = 0; placedO = 0; selectedPiece = null;
      cells.forEach(c=>{ c.textContent=''; c.classList.remove('disabled','win'); c.style.background=''; });
      updateStatus();
    }
    resetBtn.addEventListener('click', resetAll);

    cells.forEach(cell=>{
      cell.addEventListener('click', (e)=>{
        if(gameOver) return;
        const idx = parseInt(cell.dataset.index,10);
        if(piecesMode === 'three'){ handleThreeModeClick(idx); return; }
        if(board[idx] !== null) return;
        placeAt(idx, currentPlayer);
        afterMove();
      });
    });

    function placeAt(idx, player){
      board[idx] = player;
      const el = cells[idx];
      el.textContent = player;
      el.classList.add('disabled');
    }

    function afterMove(){
      const winner = checkWinner();
      if(winner){ finishGame(winner); return; }
      if(board.every(v=>v!==null)){ finishGame('draw'); return; }
      currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
      updateStatus();
      if(vsBot && currentPlayer === 'O'){ setTimeout(botTurn, 350); }
    }

    /* THREE-PIECE MODE */
    function handleThreeModeClick(idx){
      const cell = cells[idx];
      if(board[idx] === currentPlayer){
        if(selectedPiece === idx){ selectedPiece = null; cell.style.background=''; }
        else { if(selectedPiece !== null) cells[selectedPiece].style.background=''; selectedPiece = idx; cell.style.background='#004080'; }
        return;
      }
      if(board[idx] === null && selectedPiece !== null){
        board[idx] = currentPlayer; board[selectedPiece] = null;
        cells[selectedPiece].textContent=''; cells[selectedPiece].classList.remove('disabled'); cells[selectedPiece].style.background='';
        cells[idx].textContent = currentPlayer; cells[idx].classList.add('disabled');
        selectedPiece = null;
        const winner = checkWinner(); if(winner){ finishGame(winner); return; }
        currentPlayer = currentPlayer === 'X' ? 'O' : 'X'; updateStatus();
        if(vsBot && currentPlayer === 'O'){ setTimeout(botTurn, 350); }
        return;
      }
      if(board[idx] === null){
        if(currentPlayer==='X' && placedX < 3){ placedX++; board[idx]='X'; cells[idx].textContent='X'; cells[idx].classList.add('disabled'); }
        else if(currentPlayer==='O' && placedO < 3){ placedO++; board[idx]='O'; cells[idx].textContent='O'; cells[idx].classList.add('disabled'); }
        else return;
        const winner = checkWinner(); if(winner){ finishGame(winner); return; }
        currentPlayer = currentPlayer === 'X' ? 'O' : 'X'; updateStatus();
        if(vsBot && currentPlayer === 'O'){ setTimeout(botTurn, 350); }
      }
    }

    /* WIN CHECK & FINISH */
    const winningCombos = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    function checkWinner(){
      for(const combo of winningCombos){
        const [a,b,c] = combo;
        if(board[a] && board[a] === board[b] && board[a] === board[c]){
          combo.forEach(i=>cells[i].classList.add('win'));
          return board[a];
        }
      }
      return null;
    }

    function finishGame(result){
      gameOver = true;
      overlayTitle.textContent = (result === 'draw') ? 'ü§ù Empat!' : `üéâ Ha guanyat: ${result}`;
      overlayMsg.textContent = (result === 'draw') ? 'Cap jugador ha fet l√≠nia.' : `Jugador ${result} ha completat una l√≠nia.`;
      gameOverlay.style.display = 'flex';
    }

    /* BOT logic (easy/medium/hard) - igual que abans */
    function botTurn(){
      if(gameOver) return;
      if(piecesMode === 'three'){ botThreeModeMove(); return; }
      let move;
      if(difficulty === 'easy') move = randomMove();
      else if(difficulty === 'medium') move = findWinningMove('O') || findWinningMove('X') || randomMove();
      else move = minimaxMove(board, 'O').index;
      if(move === undefined || move === null) move = randomMove();
      placeAt(move, 'O');
      const winner = checkWinner(); if(winner){ finishGame(winner); return; }
      if(board.every(v=>v!==null)){ finishGame('draw'); return; }
      currentPlayer = 'X'; updateStatus();
    }
    function randomMove(){ const free = board.map((v,i)=> v===null ? i : null).filter(v=>v!==null); return free[Math.floor(Math.random()*free.length)]; }
    function findWinningMove(player){ for(const combo of winningCombos){ const [a,b,c]=combo; const line=[board[a],board[b],board[c]]; if(line.filter(v=>v===player).length===2 && line.includes(null)) return combo[line.indexOf(null)]; } return null; }

    function botThreeModeMove(){
      const countO = board.filter(v=>v==='O').length;
      if(countO < 3){
        let move;
        if(difficulty === 'easy') move = randomFree();
        else if(difficulty === 'medium') move = findWinningMove('O') || findWinningMove('X') || randomFree();
        else move = minimaxMove(board, 'O').index;
        if(move===undefined) move = randomFree();
        board[move] = 'O'; cells[move].textContent='O'; cells[move].classList.add('disabled');
        const winner = checkWinner(); if(winner){ finishGame(winner); return; }
        currentPlayer='X'; updateStatus(); return;
      }
      const myPieces = board.map((v,i)=> v==='O' ? i : null).filter(v=>v!==null);
      const empties = board.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
      for(const from of myPieces){
        for(const to of empties){
          const copy = board.slice(); copy[from]=null; copy[to]='O';
          if(checkWinnerForBoard(copy,'O')){
            board[from]=null; board[to]='O';
            cells[from].textContent=''; cells[from].classList.remove('disabled');
            cells[to].textContent='O'; cells[to].classList.add('disabled');
            const winner = checkWinner(); if(winner){ finishGame(winner); return; }
            currentPlayer='X'; updateStatus(); return;
          }
        }
      }
      const from = myPieces[Math.floor(Math.random()*myPieces.length)];
      const to = empties[Math.floor(Math.random()*empties.length)];
      board[from]=null; board[to]='O';
      cells[from].textContent=''; cells[from].classList.remove('disabled');
      cells[to].textContent='O'; cells[to].classList.add('disabled');
      const winner = checkWinner(); if(winner){ finishGame(winner); return; }
      currentPlayer='X'; updateStatus();
    }
    function randomFree(){ const free = board.map((v,i)=> v===null ? i : null).filter(v=>v!==null); return free[Math.floor(Math.random()*free.length)]; }
    function checkWinnerForBoard(bd, player){ for(const combo of winningCombos){ const [a,b,c]=combo; if(bd[a] && bd[a]===bd[b] && bd[a]===bd[c] && bd[a]===player) return true; } return false; }

    /* MINIMAX (hard) */
    function minimaxMove(newBoard, player){
      const avail = newBoard.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
      const winner = checkWinnerStatic(newBoard);
      if(winner === 'O') return {score:10};
      else if(winner === 'X') return {score:-10};
      else if(avail.length === 0) return {score:0};
      const moves = [];
      for(let i=0;i<avail.length;i++){
        const idx = avail[i];
        const move = { index: idx };
        newBoard[idx] = player;
        move.score = (player === 'O') ? minimaxMove(newBoard,'X').score : minimaxMove(newBoard,'O').score;
        newBoard[idx] = null;
        moves.push(move);
      }
      let bestMove;
      if(player === 'O'){ let bestScore=-Infinity; for(const m of moves) if(m.score>bestScore){ bestScore=m.score; bestMove=m; } }
      else { let bestScore=Infinity; for(const m of moves) if(m.score<bestScore){ bestScore=m.score; bestMove=m; } }
      return bestMove;
    }
    function checkWinnerStatic(bd){ for(const combo of winningCombos){ const [a,b,c]=combo; if(bd[a] && bd[a]===bd[b] && bd[a]===bd[c]) return bd[a]; } return null; }

    /* INIT */
    resetAll();
  </script>
</body>
</html>








